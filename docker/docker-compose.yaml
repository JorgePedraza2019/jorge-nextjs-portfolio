# docker-compose.yaml to start both frontend and backend services in local development mode in a single network
services:
  frontend:
    container_name: ${NEXT_CONTAINER_NAME}  # Assign a custom container name from the NEXT_CONTAINER_NAME environment variable
    # env_file:
    #   - ${FRONTEND_ENV_FILE}  # Load additional environment variables from the specified .env file
    build:
      context: ../frontend
      dockerfile: Dockerfile.nextjs
      args:
        NEXT_PUBLIC_ASSETS_URL: ${NEXT_PUBLIC_ASSETS_URL}
        NEXT_PUBLIC_RECAPTCHA_SITE_KEY: ${NEXT_PUBLIC_RECAPTCHA_SITE_KEY}
        NEXT_PUBLIC_RECAPTCHA_SECRET_KEY: ${NEXT_PUBLIC_RECAPTCHA_SECRET_KEY}
        NEXT_PUBLIC_GA_ID: ${NEXT_PUBLIC_GA_ID}
        NEXT_PUBLIC_INTERNAL_API_KEY: ${NEXT_PUBLIC_INTERNAL_API_KEY}
        BACKEND_URL: ${BACKEND_URL}
        NEXT_PUBLIC_ENABLE_ANALYTICS: ${NEXT_PUBLIC_ENABLE_ANALYTICS}
    environment:
      - NODE_ENV=${NODE_ENV}  # Set the environment variable inside the container (used by Next.js)
      - BACKEND_URL=${BACKEND_URL}
      - PORT=${NEXT_PORT}  # Set the port Next.js will listen on inside the container
    command: ${FRONTEND_START_COMMAND}  # Command to run the application (e.g., npm run dev or npm start)
    depends_on:
      - backend
    networks:
      - jorge-network

  backend:
    container_name: ${NEST_CONTAINER_NAME}  # Assign a custom container name from the NEXT_CONTAINER_NAME environment variable
    # env_file:
    #   - ${BACKEND_ENV_FILE}  # Load additional environment variables from the specified .env file
    build:
      context: ../backend
      dockerfile: Dockerfile.nestjs
    environment:
      - NODE_ENV=${NODE_ENV}  # Set the environment variable inside the container (used by Next.js)
      - PORT=${NEST_PORT}  # Set the port Next.js will listen on inside the container
    command: ${BACKEND_START_COMMAND}  # Command to run the application (e.g., npm run dev or npm start)
    networks:
      - jorge-network

networks:
  jorge-network:
    driver: bridge