#!/usr/bin/env sh
. "$(dirname -- "$0")/husky.sh"

# Colores
COLOR_GREEN='\033[1;32m'
COLOR_YELLOW='\033[1;33m'
COLOR_RESET='\033[0m'

# Detectar branch
BRANCH_NAME="$(git rev-parse --abbrev-ref HEAD)"

# Detectar cambios por carpeta
CHANGED_FRONTEND=$(git diff --cached --name-only | grep '^frontend/')
CHANGED_BACKEND=$(git diff --cached --name-only | grep '^backend/')

# Ejecutar checks en frontend si hay cambios
if [ -n "$CHANGED_FRONTEND" ]; then
  echo "${COLOR_GREEN}üîπ Detected frontend changes, running frontend pre-push...${COLOR_RESET}"
  bash frontend/.husky/pre-push
fi

# Ejecutar checks en backend si hay cambios
if [ -n "$CHANGED_BACKEND" ]; then
  echo "${COLOR_GREEN}üîπ Detected backend changes, running backend pre-push...${COLOR_RESET}"
  # aqu√≠ podr√≠as llamar a un script backend/.husky/pre-push si lo creas
fi

# Si no hay cambios relevantes, saltar checks
if [ -z "$CHANGED_FRONTEND" ] && [ -z "$CHANGED_BACKEND" ]; then
  echo "${COLOR_YELLOW}‚ö†Ô∏è No relevant changes for pre-push checks${COLOR_RESET}"
fi